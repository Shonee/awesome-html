<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown离线转换工具</title>
     
    <!-- 内嵌marked.js（v9.1.1 minified） -->
    <script>
    /*! marked v9.1.1 | MIT License | https://github.com/markedjs/marked */
    !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.marked=t():e.marked=t()}(self,(()=>{......}))); // 完整marked.min.js内容
    </script>
 
    <!-- 内嵌highlight.js（v11.5.0 github风格） -->
    <style>.hljs{color:#24292e;background:#fff}.hljs-doctag,......</style>
    <script>
    // 完整highlight.min.js内容
    !function(e){......}({});
    </script>
 
    <style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
     
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f5f5f5;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
 
    .header {
        background-color: #2c3e50;
        color: white;
        padding: 15px 20px;
        text-align: center;
    }
 
    .container {
        display: flex;
        flex: 1;
        overflow: hidden;
    }
 
    .editor-pane, .preview-pane {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        height: 100%;
    }
 
    .editor-pane {
        background-color: #f8f9fa;
        border-right: 1px solid #ddd;
    }
 
    .preview-pane {
        background-color: white;
    }
 
    textarea {
        width: 100%;
        height: 100%;
        min-height: 300px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
        font-family: monospace;
        font-size: 14px;
        line-height: 1.5;
    }
 
    .preview-content {
        height: 100%;
        overflow-y: auto;
        padding: 10px;
    }
 
    .toolbar {
        padding: 10px 20px;
        background-color: #ecf0f1;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
    }
 
    [url=home.php?mod=space&uid=945662]@media[/url] (max-width: 768px) {
        .container {
            flex-direction: column;
        }
        .editor-pane, .preview-pane {
            height: 50vh;
        }
    }
 
    button {
        padding: 8px 15px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
 
    button:hover {
        background-color: #2980b9;
    }
 
    #file-input {
        display: none;
    }
    </style>
</head>
<body>
    <div class="header">
        <h1>Markdown离线转换工具</h1>
    </div>
     
    <div class="toolbar">
        <div class="left-toolbar">
            <button id="upload-btn">上传MD文件</button>
            <input type="file" id="file-input" accept=".md,.markdown">
        </div>
        <div class="right-toolbar">
            <button id="download-btn">导出HTML</button>
        </div>
    </div>
     
    <div class="container">
        <div class="editor-pane">
            <textarea id="markdown-input" placeholder="输入Markdown内容..."># 欢迎使用
         
**功能特性**：
- 实时预览
- 本地存储
- 代码高亮
- 安全过滤
 
```javascript
console.log('Hello Markdown!');
```</textarea>
        </div>
         
        <div class="preview-pane">
            <div id="preview-content" class="preview-content"></div>
        </div>
    </div>
 
    <script>
    // 初始化配置
    marked.setOptions({
        breaks: true,
        gfm: true,
        sanitize: true,
        highlight: function(code, lang) {
            const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
            return hljs.highlight(code, { language: validLang }).value;
        }
    });
 
    // DOM元素
    const markdownInput = document.getElementById('markdown-input');
    const previewContent = document.getElementById('preview-content');
    const downloadBtn = document.getElementById('download-btn');
    const uploadBtn = document.getElementById('upload-btn');
    const fileInput = document.getElementById('file-input');
 
    // 防抖处理
    let updateTimeout;
    markdownInput.addEventListener('input', () => {
        clearTimeout(updateTimeout);
        updateTimeout = setTimeout(updatePreview, 300);
    });
 
    // 自动保存
    window.addEventListener('DOMContentLoaded', () => {
        markdownInput.value = localStorage.getItem('mdContent') || '';
        updatePreview();
    });
 
    window.addEventListener('beforeunload', () => {
        localStorage.setItem('mdContent', markdownInput.value);
    });
 
    // 文件处理
    uploadBtn.addEventListener('click', () => fileInput.click());
     
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
         
        const reader = new FileReader();
        reader.onload = (e) => {
            markdownInput.value = e.target.result;
            updatePreview();
        };
        reader.readAsText(file);
    });
 
    // 预览更新
    function updatePreview() {
        previewContent.innerHTML = marked.parse(markdownInput.value);
    }
 
    // 导出处理
    downloadBtn.addEventListener('click', () => {
        const exportHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>${document.querySelector('style').innerHTML}</style>
</head>
<body>
    ${marked.parse(markdownInput.value)}
</body>
</html>`;
 
        const blob = new Blob([exportHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
         
        const a = document.createElement('a');
        a.href = url;
        a.download = `markdown-${Date.now()}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
    </script>
</body>
</html>
